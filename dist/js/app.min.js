"use strict";var __extends=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}();Array.prototype.All=function(t){for(var e=0;e<this.length;e++)if(!t(this[e]))return!1;return!0},String.prototype.Format=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=this;for(var o in t)n=n.replace("{"+o+"}",arguments[o]);return n};var f14;!function(t){!function(t){var e=function(){return function(){}}();t.ActionButtonInfo=e;!function(t){t[t.Folder=0]="Folder",t[t.File=1]="File",t[t.Back=2]="Back"}(t.FileSystemItemType||(t.FileSystemItemType={}));var n=function(){return function(t,e){if(this.properties={},this.name=t,e)for(var n in e)this.properties[n]=e[n]}}();t.FileSystemInfo=n;var o=function(t){function e(e,n,o){var i=t.call(this,e,o)||this;return i.Directory=n,i.properties.extension||(i.properties.extension=e.split(".").pop()),i}return __extends(e,t),e}(n);t.FileInfo=o;var i=function(t){function e(e,n,o){var i=t.call(this,e,o)||this;return i.Folders=[],i.Files=[],i.Parent=n,i}return __extends(e,t),e.prototype.GetFullPath=function(){return void 0!==this.Parent?this.Parent.GetFullPath()+"/"+this.name:this.name},e.prototype.CreateFolder=function(t){var n=new e(t,this);return this.Folders.push(n),n},e.prototype.CreateFile=function(t){var e=new o(t,this);return this.Files.push(e),e},e.prototype.FileExists=function(t){return this.Files.some(function(e){return e.name===t})},e.prototype.FolderExists=function(t){return this.Files.some(function(e){return e.name===t})},e.prototype.GetFile=function(t){var e=this.Files.filter(function(e){return e.name===t});if(e.length>0)return e[0]},e.prototype.GetFolder=function(t){var e=this.Folders.filter(function(e){return e.name===t});if(e.length>0)return e[0]},e.prototype.GetObject=function(t){return this.GetFile(t)||this.GetFolder(t)},e.prototype.AddObject=function(t){if(t instanceof n)this._AddObject(t);else for(var e=0,o=t;e<o.length;e++){var i=o[e];this._AddObject(i)}},e.prototype._AddObject=function(t){if(t instanceof o)this.FileExists(t.name)&&this.DeleteObject(t.name),this.Files.push(t);else if(t instanceof e){var n=this.GetFolder(t.name);n?(n.AddObject(t.Files),n.AddObject(t.Folders)):this.Folders.push(t)}},e.prototype.DeleteObject=function(t){return this._DeleteObject(this.Files,t)||this._DeleteObject(this.Folders,t)},e.prototype._DeleteObject=function(t,e){for(var n=0;n<t.length;n++){var o=t[n];if(o.name===e)return t.splice(n,1),o}},e}(n);t.DirectoryInfo=i}(t.Models||(t.Models={}))}(f14||(f14={}));var f14;!function(t){!function(e){var n=function(){function e(t){this.config=t}return e.prototype.GenerateActionRequestData=function(t,e){var n=this;return{url:this.config.actionRequest,type:"POST",contentType:"application/json charset=utf-8",dataType:"json",data:JSON.stringify(t),beforeSend:this.config.xhrBeforeSend,success:function(t){n.config.DEBUG&&console.log(t),e&&e(t)}}},e.prototype.GenerateUploadRequestData=function(t,e,n){var o=this;return{url:this.config.uploadRequest,type:"POST",cache:!1,contentType:!1,processData:!1,data:t,dataType:"json",beforeSend:this.config.xhrBeforeSend,xhr:function(){var t=$.ajaxSettings.xhr();return t.upload&&n&&t.upload.addEventListener("progress",n,!1),t},success:function(t){o.config.DEBUG&&console.log(t),e&&e(t)}}},e.prototype.LoadFileSystemInfo=function(t,e){var n=this.GenerateActionRequestData(t,e);$.ajax(n)},e.prototype.RenameObjects=function(t,e){var n=this.GenerateActionRequestData(t,e);$.ajax(n)},e.prototype.DeleteObjects=function(t,e){var n=this.GenerateActionRequestData(t,e);$.ajax(n)},e.prototype.CreateObject=function(t,e){var n=this.GenerateActionRequestData(t,e);$.ajax(n)},e.prototype.MoveObjects=function(t,e){var n=this.GenerateActionRequestData(t,e);$.ajax(n)},e.prototype.UploadFile=function(e,n,o){var i=new FormData;i.append("path",t.Explorer.NavigationData.GetCurrentPath()),i.append("file",e);var a=this.GenerateUploadRequestData(i,n,o);$.ajax(a)},e}();e.RemoteDataService=n;var o=function(){function e(t){this.map=t}return e.prototype.LoadFileSystemInfo=function(t,e){var n=this.map.GetFolderItemForPath(t.path);if(void 0===n)throw"No folder info for given path: "+t.path;e({data:{folders:n.Folders,files:n.Files}})},e.prototype.RenameObjects=function(e,n){var o=e,i=this.map.GetFolderItemForPath(o.path);if(void 0===i)throw"No folder info for given path: "+o.path;var a=o.renames[0];if(console.log(a),i.FileExists(a.newName)){var r=t.Utils.getString(".popup.rename.error.exist").Format(a.newName);n({error:r,data:{errors:[r]}})}else i.GetObject(a.oldName).name=a.newName,n({success:"Done.",data:{}})},e.prototype.DeleteObjects=function(t,e){for(var n=t,o=this.map.GetFolderItemForPath(n.path),i=0,a=n.objectNames;i<a.length;i++){var r=a[i];o.DeleteObject(r)}e({success:"Done.",data:{affected:n.objectNames.length}})},e.prototype.CreateObject=function(t,e){throw new Error("Method not implemented.")},e.prototype.MoveObjects=function(t,e){var n={},o=this.map.GetFolderItemForPath(t.sourceDirectory),i=this.map.GetFolderItemForPath(t.destinationDirectory),a=[];if("move"===t.type)for(var r=0,s=t.targets;r<s.length;r++){l=s[r];(p=o.DeleteObject(l.name))&&a.push(p)}else if("copy"===t.type)for(var c=0,u=t.targets;c<u.length;c++){var l=u[c],p=o.GetObject(l.name);p&&a.push(p)}i.AddObject(a),e(n)},e.prototype.UploadFile=function(e,n,o){var i=t.Utils.NextInt(50,150),a=0,r=setInterval(function(){a+=1,o(new ProgressEvent("counter",{lengthComputable:!0,total:100,loaded:a}))},i);setTimeout(function(){clearInterval(r);var t=Math.round(Math.random());n(0===t?{error:"Fail."}:{success:"Done."})},100*i)},e}();e.InMemoryDataService=o}(t.Data||(t.Data={}))}(f14||(f14={}));var f14;!function(t){!function(t){var e=function(){function t(){this.map={}}return t.prototype.GetFolderItemForPath=function(t){return this.map[t]},t.prototype.CreateMap=function(t,e){e||(this.map[t.GetFullPath()]=t);for(var n=0,o=t.Folders;n<o.length;n++){var i=o[n];this.map[i.GetFullPath()]=i,i.Folders.length>0&&this.CreateMap(i,!0)}},t.prototype.ToString=function(){var t="NavigationMap:";for(var e in this.map)t+="\n"+e;return t},t}();t.InMemoryNavigationMap=e;var n=function(){return function(){}}();t.MoveOperationData=n;var o=function(){return function(){}}();t.AppBuffer=o}(t.Memory||(t.Memory={}))}(f14||(f14={}));var f14;!function(t){!function(t){var e=function(){function t(){this.pathStack=[]}return t.prototype.Add=function(t){this.pathStack.push(t)},t.prototype.Pop=function(){return this.pathStack.pop()},t.prototype.Clear=function(){this.pathStack.length=0},t.prototype.GetCurrentPath=function(){for(var t="",e=0,n=this.pathStack;e<n.length;e++)t+=n[e]+"/";return t.slice(0,t.length-1)},t.prototype.IsRootPath=function(t){if(void 0===t&&(t=this.GetCurrentPath()),this.pathStack.length>0)return this.pathStack[0]===t;throw"Navigation path stack is empty. Critical error."},t}();t.NavigationStack=e}(t.Navigation||(t.Navigation={}))}(f14||(f14={}));var f14;!function(t){!function(t){var e=function(){return function(){this.error=void 0,this.success=void 0}}();t.ResponseData=e;var n=function(){return function(t,e,n){this.oldName=t,this.newName=e,this.isFile=n}}();t.RenameFileInfo=n;var o=function(){return function(t,e){this.name=t,this.isFile=e}}();t.MoveTarget=o;var i=function(){return function(t){this.type=t}}();t.BaseRequestData=i;var a=function(t){function e(e){var n=t.call(this,"struct")||this;return n.path=e,n}return __extends(e,t),e}(i);t.FileSystemRequestData=a;var r=function(t){function e(e){var n=t.call(this,"rename")||this;return n.renames=[],n.path=e,n}return __extends(e,t),e.prototype.AddRenameItem=function(t,e,o){this.renames.push(new n(t,e,o))},e.prototype.HasData=function(){return this.renames.length>0},e}(i);t.RenameRequestData=r;var s=function(t){function e(e,n){var o=t.call(this,"delete")||this;return o.objectNames=[],o.path=e,n&&n.length>0&&n.forEach(function(t){return o.objectNames.push(t)}),o}return __extends(e,t),e.prototype.Add=function(t){this.objectNames.push(t)},e}(i);t.DeleteRequestData=s;var c=function(t){function e(e,n,o,i){var a=t.call(this,e)||this;return a.overwrite=!1,a.sourceDirectory=n,a.destinationDirectory=o,a.targets=i,a}return __extends(e,t),e.From=function(t){return new e(t.type,t.sourceDirectory,t.destinationDirectory,t.targets)},e}(i);t.MoveRequestData=c;var u=function(t){function e(e){return t.call(this,e)||this}return __extends(e,t),e}(i);t.CreateRequestData=u}(t.Ajax||(t.Ajax={}))}(f14||(f14={}));var f14;!function(t){!function(e){var n=function(){function e(){}return e.onItemClick=function(t,e){e.TriggerCheckState()},e.onItemDoubleClick=function(e,n){switch(n.Type){case t.Models.FileSystemItemType.Back:t.Explorer.GoBack();break;case t.Models.FileSystemItemType.File:t.Explorer.OpenFile(n.FileSystemInfo.name);break;case t.Models.FileSystemItemType.Folder:t.Explorer.GoForward(n.FileSystemInfo.name)}},e}();e.IOObjectEvents=n;var o=function(){function e(){}return e.AcceptSelection=function(e){var n=t.UI.GetCheckedItems().filter(function(e){return e.Type===t.Models.FileSystemItemType.File});if(n.length>0){var o=[],i=t.Explorer.NavigationData.GetCurrentPath();n.forEach(function(t){o.push(i+"/"+t.FileSystemInfo.name)}),t.Core.Config.DEBUG&&console.log(o),t.Core.Config.selectCallback&&t.Core.Config.selectCallback(o),window.opener&&(window.opener.selectedFiles=o,window.close())}else t.UI.ShowToast({message:t.Utils.getString(".toast.msg.selection.empty")})},e.UploadObjects=function(e){t.UI.ShowPopup(new t.UI.Popups.UploadFilesPopup)},e.RenameObjects=function(e){var n=t.UI.GetCheckedItems();if(n.length>0){var o=new t.UI.Popups.RenamePopup(n[0]);t.UI.ShowPopup(o)}},e.CreateObject=function(t){},e.DeleteObjects=function(e){var n=t.UI.GetCheckedItems();if(n.length>0){var o=new t.UI.Popups.DeletePopup(t.Explorer.NavigationData.GetCurrentPath(),n.map(function(t){return t.FileSystemInfo.name}));t.UI.ShowPopup(o)}},e.MoveObjects=function(t){e.PrepareItemsToMove("move")},e.CopyObjects=function(t){e.PrepareItemsToMove("copy")},e.PasteObjects=function(e){if(t.Core.AppBuffer.MoveOperation){var n=t.Core.AppBuffer.MoveOperation;if(n.destinationDirectory=t.Explorer.NavigationData.GetCurrentPath(),"move"===n.type&&n.destinationDirectory===n.sourceDirectory)return void t.UI.ShowToast({message:t.Utils.getString(".toast.msg.same.folder")});t.Core.Config.DEBUG&&console.log(n),t.Core.Config.dataService.MoveObjects(t.Ajax.MoveRequestData.From(n),function(e){t.Explorer.ReNavigate()})}},e.SelectObjects=function(e){var n=t.UI.GetFileStructItemSet();n.All(function(t){return t.CheckState})?n.forEach(function(t){return t.SetCheckState(!1)}):n.forEach(function(t){return t.SetCheckState(!0)})},e.PrepareItemsToMove=function(e){var n=t.UI.GetCheckedItems();if(n.length>0){var o=new t.Memory.MoveOperationData;o.type=e,o.sourceDirectory=t.Explorer.NavigationData.GetCurrentPath(),o.targets=n.map(function(e){return new t.Ajax.MoveTarget(e.FileSystemInfo.name,e.Type==t.Models.FileSystemItemType.File)}),t.Core.AppBuffer.MoveOperation=o}},e}();e.ActionButtonEvents=o}(t.Events||(t.Events={}))}(f14||(f14={}));var f14;!function(t){!function(e){function n(){if(void 0===e.Config.rootFolder)throw"Root folder must be set.";void 0===e.Config.dataService&&(e.Config.DEBUG&&console.log("The data service is not specified, configure the data service as remote."),e.Config.dataService=new t.Data.RemoteDataService(e.Config))}var o=function(){return function(){this.actionButtons=[],this.allowShortcuts=!1,this.DEBUG=!1}}();e.Configuration=o,e.L10NPrefix="f14fm",e.Title="FManager",e.TitleShort="FM",e.Config=new o,e.AppBuffer=new t.Memory.AppBuffer;var i={};e.Configure=function(t){t&&$.extend(!0,e.Config,t),n(),e.Config.allowShortcuts&&window.addEventListener("keydown",function(t){var e=void 0;e&&e.Execute(),t.preventDefault()},!1)},e.RegisterShortcut=function(t){i[t.shortcut]=t}}(t.Core||(t.Core={}))}(f14||(f14={}));var f14;!function(t){!function(t){t.Init=function(){l10n.addLocaleMap({ru:{"f14fm.io.accept":"Принять","f14fm.io.select-all":"Выбрать все","f14fm.io.clear-selection":"Снять выделение","f14fm.io.inverse-selection":"Обратить выделение","f14fm.io.upload":"Загрузить файлы","f14fm.io.select.files":"Выбрать файлы","f14fm.io.delete":"Удалить","f14fm.io.create":"Создать","f14fm.io.rename":"Переименовать","f14fm.io.move":"Переместить","f14fm.io.copy":"Копировать","f14fm.io.paste":"Вставить","f14fm.apply":"Применить","f14fm.close":"Закрыть","f14fm.cancel":"Отмена","f14fm.popup.delete.title":"Удалить файлы и папки...","f14fm.popup.delete.desc":"Вы уверены что хотите удалить эти файлы\\папки?","f14fm.popup.upload.title":"Загрузка файлов","f14fm.popup.rename.error.exist":"Файл с таким именем уже существует! Имя файла: {0}","f14fm.toast.msg.selection.empty":"Ни один файл не выбран.","f14fm.toast.msg.same.folder":"Папка назначения совпадает с исходной папкой.","f14fm.toast.delete.count.format":"Удалено {0} объектов."},en:{"f14fm.io.accept":"Done","f14fm.io.select-all":"Select All","f14fm.io.clear-selection":"Clear Selection","f14fm.io.inverse-selection":"Inverse Selection","f14fm.io.upload":"Upload Files","f14fm.io.select.files":"Select files","f14fm.io.delete":"Delete","f14fm.io.create":"Create","f14fm.io.rename":"Rename","f14fm.io.move":"Move","f14fm.io.copy":"Copy","f14fm.io.paste":"Paste","f14fm.io.apply":"Apply","f14fm.close":"Close","f14fm.cancel":"Cancel","f14fm.popup.delete.title":"Delete files and folders...","f14fm.popup.delete.desc":"Are you sure you want to delete this files\\folders?","f14fm.popup.upload.title":"File uploader","f14fm.popup.rename.error.exist":"A File with this name already exists! File name: {0}","f14fm.toast.msg.selection.empty":"No selected files.","f14fm.toast.msg.same.folder":"Destination folder coincides with the source folder.","f14fm.toast.delete.count.format":"{0} items deleted."}})}}(t.Localization||(t.Localization={}))}(f14||(f14={}));var f14;!function(t){!function(e){e.getString=function(e){return l10n.getString(t.Core.L10NPrefix+e)},e.NextInt=function(t,e){return Math.round(Math.random()*(e-t)+t)}}(t.Utils||(t.Utils={}))}(f14||(f14={}));var f14;!function(t){!function(e){function n(){a&&(a.$This.remove(),a=null)}function o(){if(void 0===(i=$("body")))throw"Current html does not contains body element.";a=new e.UIContainer,i.prepend(a.$This);var n=a.ContentPanel.FileActionPanel.ActionPanel;if(t.Core.Config.selectCallback&&n.AddButton(e.ActionButton.Create({classes:"btn-primary",icon:"mdl2-accept",text:t.Utils.getString(".io.accept"),action:t.Events.ActionButtonEvents.AcceptSelection})),t.Core.Config.uploadRequest&&n.AddButton(e.ActionButton.Create({classes:"btn-primary",icon:"mdl2-upload",text:t.Utils.getString(".io.upload"),action:t.Events.ActionButtonEvents.UploadObjects})),n.AddButton(e.ActionButton.Create({icon:"mdl2-delete",text:t.Utils.getString(".io.delete"),action:t.Events.ActionButtonEvents.DeleteObjects})),n.AddButton(e.ActionButton.Create({icon:"mdl2-rename",text:t.Utils.getString(".io.rename"),action:t.Events.ActionButtonEvents.RenameObjects})),n.AddButton(e.ActionButton.Create({icon:"mdl2-copy",text:t.Utils.getString(".io.copy"),shortcut:"ctrl+c",action:t.Events.ActionButtonEvents.CopyObjects})),n.AddButton(e.ActionButton.Create({icon:"mdl2-move",text:t.Utils.getString(".io.move"),shortcut:"ctrl+x",action:t.Events.ActionButtonEvents.MoveObjects})),n.AddButton(e.ActionButton.Create({icon:"mdl2-paste",text:t.Utils.getString(".io.paste"),shortcut:"ctrl+v",action:t.Events.ActionButtonEvents.PasteObjects})),n.AddButton(e.ActionButton.Create({icon:"mdl2-select-all",text:t.Utils.getString(".io.select-all"),action:t.Events.ActionButtonEvents.SelectObjects})),t.Core.Config.actionButtons&&t.Core.Config.actionButtons.length>0)for(var o=0,r=t.Core.Config.actionButtons;o<r.length;o++){var s=r[o];n.AddButton(e.ActionButton.Create(s))}}var i,a;e.Render=function(){n(),o()},e.RenderFileStruct=function(e,n){t.Core.Config.DEBUG&&console.log("Folders: "+e.length+" Files: "+n.length),a.ContentPanel.FileStructPanel.Fill(e,n)},e.GetUIContainer=function(){return a},e.GetFileStructItemSet=function(){return a.ContentPanel.FileStructPanel.Items},e.GetCheckedItems=function(){return a.ContentPanel.FileStructPanel.GetCheckedItems()},e.ShowPopup=function(t){a.PopupContainer.SetPopup(t)},e.HidePopup=function(){a.PopupContainer.UnsetPopup()},e.ShowToast=function(t){a.ToastContainer.Show(t)},e.HideToast=function(){a.ToastContainer.Hide()}}(t.UI||(t.UI={}))}(f14||(f14={}));var f14;!function(t){!function(e){var n=t.Models,o=function(){return function(){this.$This=$("<div>").addClass("ui-container"),this.$This.append((this.ToastContainer=new i).$This),this.$This.append((this.PopupContainer=new a).$This),this.$This.append((this.ContentPanel=new r).$This)}}();e.UIContainer=o;var i=function(){function t(){this.isShown=!1,this.$This=$("<div>").addClass("ui-toast-container"),this.$Title=$("<div>").addClass("ui-toast-title").appendTo(this.$This),this.$Message=$("<div>").addClass("ui-toast-message").appendTo(this.$This),this.$Title.text("Toast title"),this.$Message.text("Lorem Ipsum is simply dummy text of the printing and typesetting industry. Lorem Ipsum has been the industry's standard dummy text ever since the 1500s, when an unknown printer took a galley of type and scrambled it to make a type specimen book. It has survived not only five centuries, but also the leap into electronic typesetting, remaining essentially unchanged. It was popularised in the 1960s with the release of Letraset sheets containing Lorem Ipsum passages, and more recently with desktop publishing software like Aldus PageMaker including versions of Lorem Ipsum."),this.$This.hide()}return t.prototype.IsShown=function(){return this.isShown},t.prototype.Show=function(t){var e=this;if(!this.isShown){t.title&&t.title.length>0?(this.$Title.text(t.title),this.$Title.css("display","block")):this.$Title.css("display","none"),this.$Message.text(t.message);var n=Math.min(1e4,t.timeout)||3e3,o=function(t){t.isShown=!0,setTimeout(function(){t.Hide()},n)};this.$This.css({display:"",top:"-300px",opacity:"0"}).animate({top:"0px",opacity:"1"},400,function(){return o(e)})}},t.prototype.Hide=function(){var t=this;this.$This.animate({top:"-300px",opacity:"0"},150,function(){t.isShown=!1,t.$This.css("display","none")})},t}();e.ToasContainer=i;var a=function(){function t(){this.$This=$("<div>").addClass("ui-popup-container"),this.$This.css("opacity","0"),this.$This.css("display","none")}return t.prototype.SetPopup=function(t){if(this.Popup){this.UnsetPopup();var e=this;setTimeout(function(){e.SetPopup(t)},500)}else this.Popup=t,this.$This.append(t.$This),this.$This.css("display","flex"),this.$This.fadeTo(150,1)},t.prototype.UnsetPopup=function(){if(this.Popup){var t=this;this.$This.fadeTo(150,0,function(){t.$This.css("display","none"),t.$This.empty(),t.Popup=void 0})}},t}();e.PopupContainer=a;var r=function(){return function(){this.$This=$("<div>").addClass("ui-content-panel"),this.$This.append((this.FileActionPanel=new s).$This),this.$This.append((this.FileStructPanel=new c).$This)}}();e.ContentPanel=r;var s=function(){return function(){this.$This=$("<div>").addClass("ui-file-action-panel"),this.$This.append((this.LogoButton=new e.LogoButton).$This),this.$This.append((this.ActionPanel=new u).$This)}}();e.FileActionPanel=s;var c=function(){function e(){this.Items=[],this.$This=$("<div>").addClass("ui-file-struct-panel")}return e.prototype.Fill=function(e,o){this.Items.length=0,this.$This.empty(),t.Explorer.NavigationData.IsRootPath()||this.AddItem(n.FileSystemItemType.Back);for(var i=0,a=e;i<a.length;i++){c=a[i];this.AddItem(n.FileSystemItemType.Folder,c)}for(var r=0,s=o;r<s.length;r++){var c=s[r];this.AddItem(n.FileSystemItemType.File,c)}},e.prototype.AddItem=function(t,e){t===n.FileSystemItemType.Back&&(e={name:"up"});var o=new l(t,e);this.Items.push(o),this.$This.append(o.$This)},e.prototype.GetCheckedItems=function(){return this.Items.filter(function(t){return t.CheckState})},e}();e.FileStructPanel=c;var u=function(){function t(){this.Buttons=[],this.$This=$("<div>").addClass("ui-action-buttons-panel")}return t.prototype.AddButton=function(t){this.Buttons.push(t),this.$This.append(t.$This)},t}();e.ActionPanel=u;var l=function(){function e(e,o){var i=this;switch(this.CheckState=!1,this.Type=e,this.FileSystemInfo=o,this.$This=$("<div>").addClass("ui-file-struct-item ui-input-group").on("click",function(e){return t.Events.IOObjectEvents.onItemClick(e,i)}).on("dblclick",function(e){return t.Events.IOObjectEvents.onItemDoubleClick(e,i)}),this.IconContainer=$("<div>").addClass("ui-item-icon"),this.NameContainer,this.Icon=$("<i>"),this.IconContainer.append(this.Icon),e){case n.FileSystemItemType.File:this.Icon.addClass("mdl2-file");break;case n.FileSystemItemType.Folder:this.Icon.addClass("mdl2-folder");break;case n.FileSystemItemType.Back:this.Icon.addClass("mdl2-more")}e!==n.FileSystemItemType.Back&&(this.CheckBox=$("<div>").addClass("ui-item-check"),this.NameContainer=$("<div>").addClass("ui-item-name").text(o.name)),this.CheckBox&&(this.CheckBox.on("click",function(t){return i.CheckBoxStateChangeHandler(t,i)}),this.createInputGroupItem("min").append(this.CheckBox).appendTo(this.$This)),this.createInputGroupItem("min").append(this.IconContainer).appendTo(this.$This),this.NameContainer&&this.createInputGroupItem("max").append(this.NameContainer).appendTo(this.$This)}return e.prototype.createInputGroupItem=function(t){return $("<div>").addClass("ui-input-group-item "+t)},e.prototype.SetItemName=function(t){this.FileSystemInfo.name=t,this.NameContainer.text(t)},e.prototype.SetCheckState=function(t){this.CheckState=t,this.CheckState?this.$This.addClass("checked"):this.$This.removeClass("checked")},e.prototype.TriggerCheckState=function(){this.CheckBox&&this.Type===t.Models.FileSystemItemType.File&&this.CheckBox.trigger("click")},e.prototype.CheckBoxStateChangeHandler=function(t,e){e.SetCheckState(!e.CheckState),t&&t.stopPropagation()},e.prototype.ToString=function(){return"[Type: "+this.Type+", Name: "+this.FileSystemInfo.name+", CheckState: "+this.CheckState},e}();e.FileStructItem=l}(t.UI||(t.UI={}))}(f14||(f14={}));var f14;!function(t){!function(e){var n=function(){function t(t,e,n){this.$This=$("<div>").addClass("ui-btn"),n&&n.length>0&&this.$This.addClass(n),this.SetIcon(e),this.SetText(t)}return t.prototype.SetText=function(t){return this.$Text||(this.$Text=$("<span>").addClass("ui-btn-text").appendTo(this.$This)),t||(t=""),this.$Text.text(t),this.$This.attr("title",t),this},t.prototype.SetIcon=function(t){return void 0!==t&&t.length>0?this.$Icon?(this.$Icon.removeClass(),this.$Icon.addClass(t)):this.$Icon=$("<i>").addClass("ui-btn-icon").addClass(t).prependTo(this.$This):this.$Icon&&(this.$Icon.remove(),this.$Icon=void 0),this},t.prototype.OnClick=function(t){return t?this.$This.on("click",t):this.$This.off("click"),this},t}();e.BaseButton=n;var o=function(t){function e(){var e=t.call(this)||this;return e.$This.addClass("ui-action-btn"),e}return __extends(e,t),e.prototype.SetText=function(e){return t.prototype.SetText.call(this,e)},e.prototype.SetIcon=function(e){return t.prototype.SetIcon.call(this,e)},e.prototype.Execute=function(){this.$This.trigger("click")},e.Create=function(t){var n=new e;return t.classes&&n.$This.addClass(t.classes),n.SetText(t.text),n.SetIcon(t.icon),n.OnClick(t.action),n.shortcut=t.shortcut,n},e}(n);e.ActionButton=o;var i=function(){return function(){var n=this;this.$This=$("<div>").addClass("ui-logo-button"),this.$Text=$("<span>").text(t.Core.Title).appendTo(this.$This),this.$This.on("click",function(o){var i=e.GetUIContainer().ContentPanel.FileActionPanel;i.$This.hasClass("collapsed")?(i.$This.removeClass("collapsed"),n.$Text.text(t.Core.Title)):(i.$This.addClass("collapsed"),n.$Text.text(""))})}}();e.LogoButton=i}(t.UI||(t.UI={}))}(f14||(f14={}));var f14;!function(t){!function(t){var e=function(){return function(){this.$This=$("<input>").addClass("ui-textbox")}}();t.TextBox=e}(t.UI||(t.UI={}))}(f14||(f14={}));var f14;!function(t){!function(e){!function(n){var o=function(){function n(){this.FooterButtons=[],this.$This=$("<div>").addClass("ui-popup"),this.Container=$("<div>").addClass("container").appendTo(this.$This),this.Header=$("<div>").addClass("ui-popup-header"),this.Body=$("<div>").addClass("ui-popup-body"),this.Footer=$("<div>").addClass("ui-popup-footer"),this.AddErrorSection(),this.Container.append(this.Header).append(this.Body).append(this.Footer)}return n.prototype.SetTitle=function(t){this.Title||(this.Title=$("<span>").addClass("ui-popup-title"),this.Header.append(this.Title)),this.Title.text(t)},n.prototype.AddFooterButton=function(t){this.FooterButtons.push(t),this.Footer.append(t.$This)},n.prototype.AddErrorSection=function(){this.ErrorSection=$("<div>").addClass("ui-popup-errors").appendTo(this.Body).hide()},n.prototype.PopulatePayloadErrors=function(t){var e=this;this.ErrorSection.empty();var n=function(t){$("<div>").addClass("ui-popup-error-message").text(t).appendTo(e.ErrorSection)};if(t.data&&t.data.errors)for(var o=0,i=t.data.errors;o<i.length;o++)n(i[o]);else n(t.error);this.ErrorSection.show(200)},n.prototype.GenerateButton=function(t,n){var o=new e.BaseButton;return o.SetText(t),n&&o.$This.on("click",n),o},n.prototype.CreateCloseBtn=function(){return this.GenerateButton(t.Utils.getString(".close"),function(t){e.HidePopup()})},n}();n.Popup=o;var i=function(n){function o(o){var i=n.call(this)||this;i.SetTitle(t.Utils.getString(".io.rename")),i.item=o,i.CreateRenameTextbox(i.item);var a=i.GenerateButton(t.Utils.getString(".apply"),function(n){var o=i.Body.find(".tb-rename"),a=new t.Ajax.RenameRequestData(t.Explorer.NavigationData.GetCurrentPath()),r=o.attr("data-origin-name"),s=o.val();r!==s&&a.AddRenameItem(r,s,o.data("io-type")==t.Models.FileSystemItemType.File),a.HasData()?t.Core.Config.dataService.RenameObjects(a,function(t){i.updateItemNames(a,t)}):e.HidePopup()});return i.AddFooterButton(a),i.AddFooterButton(i.CreateCloseBtn()),i}return __extends(o,n),o.prototype.CreateRenameTextbox=function(t){var n=t.FileSystemInfo.name,o=new e.TextBox;o.$This.addClass("tb-rename"),o.$This.attr("data-origin-name",n),o.$This.data("io-type",t.Type),o.$This.val(n),this.Body.append(o.$This)},o.prototype.updateItemNames=function(t,n){if(n)if(n.error)this.PopulatePayloadErrors(n);else{for(var o=0,i=t.renames;o<i.length;o++){var a=i[o];this.item.SetItemName(a.newName)}e.HidePopup()}},o}(o);n.RenamePopup=i;var a=function(n){function o(o,i){var a=n.call(this)||this;a.$This.addClass("danger"),a.SetTitle(t.Utils.getString(".popup.delete.title")),a.FolderPath=o,a.ItemNames=i,$("<p>").text(t.Utils.getString(".popup.delete.desc")).appendTo(a.Body);var r=a.GenerateButton(t.Utils.getString(".io.delete"),function(n){var o=new t.Ajax.DeleteRequestData(a.FolderPath,a.ItemNames);t.Core.Config.dataService.DeleteObjects(o,function(n){t.Core.Config.DEBUG&&console.log(o),n.error&&a.PopulatePayloadErrors(n),n.data.affected>0&&(t.Explorer.ReNavigate(),e.ShowToast({message:t.Utils.getString(".toast.delete.count.format").Format(n.data.affected)}),n.success&&e.HidePopup())})});return a.AddFooterButton(r),a.AddFooterButton(a.CreateCloseBtn()),a}return __extends(o,n),o}(o);n.DeletePopup=a;var r=function(n){function o(){var e=n.call(this)||this;return e.tasksCount=0,e.SetTitle(t.Utils.getString(".popup.upload.title")),e.$Form=$("<form>").addClass("ui-upload-form").appendTo(e.Body),e.$Form.text("No files selected."),e.AddFooterButton(e.CreateFileSelectBtn()),e.AddFooterButton(e.CreateUploadButton()),e.AddFooterButton(e.CreateCloseBtn()),e}return __extends(o,n),o.prototype.AddFilePresenter=function(t){var n=$("<div>").addClass("ui-input-group file-container").data("file",t);$("<div>").addClass("ui-input-group-item max").text(t.name).appendTo(n),$("<div>").addClass("ui-input-group-item min actions").append(new e.BaseButton("","mdl2-close","icon-transparent close-btn").OnClick(function(t){$(t.target).closest(".file-container").remove()}).$This).appendTo(n),$("<div>").addClass("ui-input-group-item min status").append($("<i>").addClass("mdl2 status-value")).appendTo(n),$("<div>").addClass("ui-input-group-item min progress").append($("<div>").addClass("progress-value").text("0%")).appendTo(n);this.$Form.append(n)},o.prototype.CreateFileSelectBtn=function(){var n=this,o=new e.BaseButton;o.$This.addClass("btn-file"),o.SetText(t.Utils.getString(".io.select.files"));var i=$("<input>").attr("type","file").attr("multiple","multiple").attr("accept",t.Core.Config.uploadFileFilter||"*");return i.on("change",function(t){var e=t.target.files;if(e.length>0){n.$Form.empty();for(var o in e)e[o]instanceof File&&n.AddFilePresenter(e[o])}}),o.$This.append(i),o},o.prototype.CreateUploadButton=function(){var e=this,n=this.GenerateButton(t.Utils.getString(".io.upload"),function(o){var i=e.$Form.find(".file-container:not(.loading,.success,.error)");i.length>0&&($(e.Footer.find(".btn-file")).addClass("disabled"),n.$This.addClass("disabled"),i.each(function(o,i){e.tasksCount+=1;var a=$(i),r=$(a.find(".progress-value")[0]),s=a.data("file");a.addClass("loading"),t.Core.Config.dataService.UploadFile(s,function(o){a.removeClass("loading"),o.success?a.addClass("success"):a.addClass("error"),e.tasksCount=Math.max(0,e.tasksCount-1),0===e.tasksCount&&($(e.Footer.find(".btn-file")).removeClass("disabled"),n.$This.removeClass("disabled"),t.Explorer.ReNavigate())},function(t){if(t.lengthComputable){var e=Math.ceil(t.loaded/t.total*100);r.text(e+"%")}})}))});return n.$This.addClass("btn-primary btn-upload"),n},o}(o);n.UploadFilesPopup=r}(e.Popups||(e.Popups={}))}(t.UI||(t.UI={}))}(f14||(f14={}));var f14;!function(t){!function(t){!function(t){var e=function(){return function(){}}();t.ToastData=e}(t.Toasts||(t.Toasts={}))}(t.UI||(t.UI={}))}(f14||(f14={}));var f14;!function(t){!function(e){function n(){var n=e.NavigationData.GetCurrentPath();t.Core.Config.DEBUG&&console.log("Navigate => "+n),t.Core.Config.dataService.LoadFileSystemInfo(new t.Ajax.FileSystemRequestData(n),function(e){t.UI.RenderFileStruct(e.data.folders,e.data.files)})}e.NavigationData=new t.Navigation.NavigationStack,e.NavigateTo=function(t){if(void 0===t)throw"Folder path must be set.";e.NavigationData.Clear(),e.NavigationData.Add(t),n()},e.GoForward=function(t){t&&(e.NavigationData.Add(t),n())},e.GoBack=function(){e.NavigationData.Pop(),n()},e.ReNavigate=function(){n()},e.OpenFile=function(t){}}(t.Explorer||(t.Explorer={}))}(f14||(f14={}));var FManager=function(){return function(t){f14.Localization.Init(),f14.Core.Configure(t),f14.UI.Render(),f14.Explorer.NavigateTo(f14.Core.Config.rootFolder)}}(),f14;!function(t){!function(e){var n=function(){function e(t){this.GenerateTestData(),new FManager(t)}return e.prototype.GenerateTestData=function(){var e=new t.Memory.InMemoryNavigationMap,n=new t.Models.DirectoryInfo("C:");n.CreateFile("boot.sys"),n.CreateFile("autorun.exe"),n.CreateFile("pagefile.sys");for(var o=n.CreateFolder("MyDocs"),i=(n.CreateFolder("Users"),o.CreateFolder("Images")),a=0;a<30;a++){var r="image-"+(a+1)+".jpg";i.CreateFile(r)}for(var s=o.CreateFolder("Sounds"),a=0;a<10;a++){var c="sound-"+(a+1)+".mp3";s.CreateFile(c)}e.CreateMap(n,!1),console.log(e.ToString()),t.Core.Config.dataService=new t.Data.InMemoryDataService(e)},e}();e.FManagerTest=n}(t.Tests||(t.Tests={}))}(f14||(f14={}));