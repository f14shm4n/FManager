"use strict";var __extends=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}();Array.prototype.All=function(t){for(var e=0;e<this.length;e++){if(!t(this[e]))return!1}return!0},String.prototype.Format=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=this;for(var o in t)n=n.replace("{"+o+"}",arguments[o]);return n};!function(t){!function(t){var e=function(){return function(){}}();t.ActionButtonInfo=e;!function(t){t[t.Folder=0]="Folder",t[t.File=1]="File",t[t.Back=2]="Back"}(t.FileSystemItemType||(t.FileSystemItemType={}));var n=function(){return function(t,e){if(this.properties={},this.name=t,e)for(var n in e)this.properties[n]=e[n]}}();t.BaseFileInfo=n;var o=function(t){function e(e,n,o){var i=t.call(this,e,o)||this;return i.Directory=n,i.properties.extension||(i.properties.extension=e.split(".").pop()),i}return __extends(e,t),e}(n);t.FileInfo=o;var i=function(t){function e(e,n,o){var i=t.call(this,e,o)||this;return i.Folders=[],i.Files=[],i.Parent=n,i}return __extends(e,t),e.prototype.GetFullPath=function(){return void 0!==this.Parent?this.Parent.GetFullPath()+"/"+this.name:this.name},e.prototype.CreateFolder=function(t){var n=new e(t,this);return this.Folders.push(n),n},e.prototype.CreateFile=function(t){var e=new o(t,this);return this.Files.push(e),e},e.prototype.FileExists=function(t){return this.Files.some(function(e){return e.name===t})},e.prototype.FolderExists=function(t){return this.Files.some(function(e){return e.name===t})},e.prototype.GetFile=function(t){var e=this.Files.filter(function(e){return e.name===t});if(e.length>0)return e[0]},e.prototype.GetFolder=function(t){var e=this.Folders.filter(function(e){return e.name===t});if(e.length>0)return e[0]},e.prototype.GetObject=function(t){return this.GetFile(t)||this.GetFolder(t)},e.prototype.AddObject=function(t){if(t instanceof n)this._AddObject(t);else for(var e=0,o=t;e<o.length;e++){var i=o[e];this._AddObject(i)}},e.prototype._AddObject=function(t){if(t instanceof o)this.FileExists(t.name)&&this.DeleteObject(t.name),this.Files.push(t);else if(t instanceof e){var n=this.GetFolder(t.name);n?(n.AddObject(t.Files),n.AddObject(t.Folders)):this.Folders.push(t)}},e.prototype.DeleteObject=function(t){return this._DeleteObject(this.Files,t)||this._DeleteObject(this.Folders,t)},e.prototype._DeleteObject=function(t,e){for(var n=0;n<t.length;n++){var o=t[n];if(o.name===e)return t.splice(n,1),o}},e}(n);t.DirectoryInfo=i}(t.Models||(t.Models={}))}(f14||(f14={}));!function(t){!function(t){var e=function(){function t(){this.map={}}return t.prototype.GetFolderItemForPath=function(t){return this.map[t]},t.prototype.MapFolder=function(t){this.map[t.GetFullPath()]=t;for(var e=0,n=t.Folders;e<n.length;e++){var o=n[e];this.map[o.GetFullPath()]=o,o.Folders.length>0&&this.MapFolder(o)}},t.prototype.replace=function(t,e){delete this.map[t],this.MapFolder(e)},t.prototype.ToString=function(){var t="NavigationMap:";for(var e in this.map)t+="\n"+e;return t},t}();t.InMemoryNavigationMap=e;var n=function(){return function(){}}();t.MoveOperationData=n;var o=function(){return function(){}}();t.AppBuffer=o}(t.Memory||(t.Memory={}))}(f14||(f14={}));!function(t){!function(t){var e=function(){function t(){this.pathStack=[]}return t.prototype.Add=function(t){this.pathStack.push(t)},t.prototype.Pop=function(){return this.pathStack.pop()},t.prototype.Clear=function(){this.pathStack.length=0},t.prototype.GetCurrentPath=function(){for(var t="",e=0,n=this.pathStack;e<n.length;e++){t+=n[e]+"/"}return t.slice(0,t.length-1)},t.prototype.IsRootPath=function(t){if(void 0===t&&(t=this.GetCurrentPath()),this.pathStack.length>0)return this.pathStack[0]===t;throw"Navigation path stack is empty. Critical error."},t}();t.NavigationStack=e}(t.Navigation||(t.Navigation={}))}(f14||(f14={}));!function(t){!function(t){var e=function(){function t(){}return t.FolderStruct="folder_struct",t.Rename="rename",t.Delete="delete",t.Move="move",t.Copy="copy",t.CreateFolder="create_folder",t.UploadFile="upload_file",t}();t.AjaxActionTypes=e;var n=function(){return function(t,e){this.name=t,this.isFile=e}}();t.BaseActionTarget=n;var o=function(t){function e(e,n,o){var i=t.call(this,n,o)||this;return i.oldName=e,i}return __extends(e,t),e}(n);t.RenameActionTarget=o}(t.Ajax||(t.Ajax={}))}(f14||(f14={}));!function(t){!function(t){var e=function(){return function(){}}();t.BaseParam=e;var n=function(t){function e(e){var n=t.call(this)||this;return n.targets=[],e&&(n.targets=e),n}return __extends(e,t),e}(e);t.TargetCollectionParam=n;var o=function(t){function e(e,n,o){var i=t.call(this,o)||this;return i.overwrite=!1,i.sourceDirectory=e,i.destinationDirectory=n,i}return __extends(e,t),e}(n);t.MoveParam=o;var i=function(t){function e(e,n,o){return t.call(this,e,n,o)||this}return __extends(e,t),e}(o);t.CopyParam=i;var r=function(t){function e(e,n){var o=t.call(this,n)||this;return o.currentFolderPath=e,o}return __extends(e,t),e}(n);t.DeleteParam=r;var a=function(t){function e(e,n){var o=t.call(this)||this;return o.currentFolderPath=e,o.name=n,o}return __extends(e,t),e}(e);t.CreateFolderParam=a;var s=function(e){function n(t,n){var o=e.call(this,n)||this;return o.currentFolderPath=t,o}return __extends(n,e),n.prototype.AddRenameItem=function(e,n,o){this.targets.push(new t.RenameActionTarget(e,n,o))},n.prototype.HasData=function(){return this.targets.length>0},n}(n);t.RenameParam=s;var l=function(t){function e(e,n){var o=t.call(this)||this;return o.fileExtensions=[],o.currentFolderPath=e,o.fileExtensions=n,o}return __extends(e,t),e}(e);t.FolderStructParam=l;var u=function(t){function e(e,n,o){var i=t.call(this)||this;return i.currentFolderPath=e,i.file=n,i.progressChanged=o,i}return __extends(e,t),e.prototype.makeFormData=function(){var t=new FormData;return t.append("currentFolderPath",this.currentFolderPath),t.append("file",this.file),t},e}(e);t.UploadFileParam=u}(t.Ajax||(t.Ajax={}))}(f14||(f14={}));!function(t){!function(t){var e=function(){function t(){this.errors=[]}return t.prototype.hasErrors=function(){return this.errors&&this.errors.length>0},t}();t.BaseResult=e;var n=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e}(e);t.AffectedResult=n;var o=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e}(e);t.MoveResult=o;var i=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e}(o);t.CopyResult=i;var r=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e}(n);t.DeleteResult=r;var a=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e}(e);t.CreateFolderResult=a;var s=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.folders=[],e.files=[],e}return __extends(e,t),e}(e);t.FolderStructResult=s;var l=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.renamedObjects=[],e}return __extends(e,t),e}(n);t.RenameResult=l;var u=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e}(e);t.UploadFileResult=u}(t.Ajax||(t.Ajax={}))}(f14||(f14={}));!function(t){!function(t){var e=function(){function t(t){this.config=t}return t.prototype.execute=function(t,e){var n=this.makeAjaxData(this.getUrl(),t,e);$.ajax(n)},t.prototype.makeAjaxData=function(t,e,n){var o=this;this.callback=n;var i={url:t,type:"POST",contentType:"application/json charset=utf-8",dataType:"json",data:JSON.stringify(e),beforeSend:this.config.xhrBeforeSend,success:function(t){return o.ajaxSuccess(t)},error:function(t,e,n){return o.ajaxError(t,e,n)}};return this.extendAjaxData(i,e),i},t.prototype.extendAjaxData=function(t,e){},t.prototype.ajaxSuccess=function(t){this.config.DEBUG&&console.log(t),this.callback&&this.callback(this.makeResultFrom(t))},t.prototype.ajaxError=function(t,e,n){console.log("Status: %s\nError: %s",e)},t}();t.BaseOperationRequest=e;var n=function(e){function n(t){return e.call(this,t)||this}return __extends(n,e),n.prototype.getUrl=function(){return this.config.endPointUrlMap[t.AjaxActionTypes.Copy]},n.prototype.makeResultFrom=function(e){var n=new t.CopyResult;return $.extend(!0,n,e),n},n}(e);t.CopyRequest=n;var o=function(e){function n(t){return e.call(this,t)||this}return __extends(n,e),n.prototype.getUrl=function(){return this.config.endPointUrlMap[t.AjaxActionTypes.Move]},n.prototype.makeResultFrom=function(e){var n=new t.MoveResult;return $.extend(!0,n,e),n},n}(e);t.MoveRequest=o;var i=function(e){function n(t){return e.call(this,t)||this}return __extends(n,e),n.prototype.getUrl=function(){return this.config.endPointUrlMap[t.AjaxActionTypes.CreateFolder]},n.prototype.makeResultFrom=function(e){var n=new t.CreateFolderResult;return $.extend(!0,n,e),n},n}(e);t.CreateFolderRequest=i;var r=function(e){function n(t){return e.call(this,t)||this}return __extends(n,e),n.prototype.getUrl=function(){return this.config.endPointUrlMap[t.AjaxActionTypes.Delete]},n.prototype.makeResultFrom=function(e){var n=new t.DeleteResult;return $.extend(!0,n,e),n},n}(e);t.DeleteRequest=r;var a=function(e){function n(t){return e.call(this,t)||this}return __extends(n,e),n.prototype.getUrl=function(){return this.config.endPointUrlMap[t.AjaxActionTypes.FolderStruct]},n.prototype.makeResultFrom=function(e){var n=new t.FolderStructResult;return $.extend(!0,n,e),n},n}(e);t.FolderStructRequest=a;var s=function(e){function n(t){return e.call(this,t)||this}return __extends(n,e),n.prototype.getUrl=function(){return this.config.endPointUrlMap[t.AjaxActionTypes.Rename]},n.prototype.makeResultFrom=function(e){var n=new t.RenameResult;return $.extend(!0,n,e),n},n}(e);t.RenameRequest=s;var l=function(e){function n(){return null!==e&&e.apply(this,arguments)||this}return __extends(n,e),n.prototype.getUrl=function(){return this.config.endPointUrlMap[t.AjaxActionTypes.UploadFile]},n.prototype.extendAjaxData=function(t,e){$.extend(!0,t,{cache:!1,contentType:!1,processData:!1,data:e.makeFormData(),xhr:function(){var t=$.ajaxSettings.xhr();return t.upload&&e.progressChanged&&t.upload.addEventListener("progress",e.progressChanged,!1),t}})},n.prototype.makeResultFrom=function(e){var n=new t.UploadFileResult;return $.extend(!0,n,e),n},n}(e);t.UploadFileRequest=l}(t.Ajax||(t.Ajax={}))}(f14||(f14={}));!function(t){!function(e){var n=function(){function e(){}return e.AcceptSelection=function(e){var n=t.UI.GetCheckedItems().filter(function(e){return e.Type===t.Models.FileSystemItemType.File});if(n.length>0){var o=[],i=t.Explorer.NavigationData.GetCurrentPath();n.forEach(function(t){o.push(i+"/"+t.FileSystemInfo.name)}),t.Core.Config.DEBUG&&console.log(o),t.Core.Config.selectCallback&&t.Core.Config.selectCallback(o),window.opener&&(window.opener.selectedFiles=o,window.close())}else t.UI.ShowToast({message:t.Utils.getString(".toast.msg.selection.empty")})},e.UploadObjects=function(e){t.UI.ShowPopup(new t.UI.Popups.UploadFilesPopup)},e.RenameObjects=function(e){var n=t.UI.GetCheckedItems();if(n.length>0){var o=new t.UI.Popups.RenamePopup(n[0]);t.UI.ShowPopup(o)}},e.CreateFolder=function(e){var n=new t.Ajax.CreateFolderParam(t.Explorer.NavigationData.GetCurrentPath(),"new folder");t.Core.Config.ajaxRequestMap[t.Ajax.AjaxActionTypes.CreateFolder].execute(n,function(e){var n=e;n.hasErrors()?t.UI.DisplayPayloadError(n):t.UI.ShowToast({message:t.Utils.getString(".toast.msg.dir.created")}),t.Explorer.ReNavigate()})},e.DeleteObjects=function(e){var n=t.UI.GetCheckedItems();if(n.length>0){var o=new t.UI.Popups.DeletePopup(t.Explorer.NavigationData.GetCurrentPath(),n.map(function(e){return new t.Ajax.BaseActionTarget(e.FileSystemInfo.name,e.Type==t.Models.FileSystemItemType.File)}));t.UI.ShowPopup(o)}},e.MoveObjects=function(n){e.PrepareItemsToMove(t.Ajax.AjaxActionTypes.Move)},e.CopyObjects=function(n){e.PrepareItemsToMove(t.Ajax.AjaxActionTypes.Copy)},e.PasteObjects=function(e){if(t.Core.AppBuffer.MoveOperation){var n=t.Core.AppBuffer.MoveOperation;if(n.destinationDirectory=t.Explorer.NavigationData.GetCurrentPath(),"move"===n.type&&n.destinationDirectory===n.sourceDirectory)return void t.UI.ShowToast({message:t.Utils.getString(".toast.msg.same.folder")});t.Core.Config.DEBUG&&console.log(n);var o,i=n.sourceDirectory,r=n.destinationDirectory,a=n.targets.map(function(e,n,o){return new t.Ajax.BaseActionTarget(e.name,e.isFile)});switch(n.type){case t.Ajax.AjaxActionTypes.Move:o=new t.Ajax.MoveParam(i,r,a);break;case t.Ajax.AjaxActionTypes.Copy:o=new t.Ajax.CopyParam(i,r,a)}t.Core.Config.ajaxRequestMap[n.type].execute(o,function(e){e.hasErrors()&&t.UI.DisplayPayloadError(e),t.Explorer.ReNavigate()})}},e.SelectObjects=function(e){var n=t.UI.GetFileStructItemSet();n.All(function(t){return t.CheckState})?n.forEach(function(t){return t.SetCheckState(!1)}):n.forEach(function(t){return t.SetCheckState(!0)})},e.PrepareItemsToMove=function(e){var n=t.UI.GetCheckedItems();if(n.length>0){var o=new t.Memory.MoveOperationData;o.type=e,o.sourceDirectory=t.Explorer.NavigationData.GetCurrentPath(),o.targets=n.map(function(e){return new t.Ajax.BaseActionTarget(e.FileSystemInfo.name,e.Type==t.Models.FileSystemItemType.File)}),t.Core.AppBuffer.MoveOperation=o}},e}();e.ActionButtonEvents=n}(t.Events||(t.Events={}))}(f14||(f14={}));!function(t){!function(e){var n=function(){return function(){this.actionButtons=[],this.allowShortcuts=!1,this.DEBUG=!1,this.MOCK=!1,this.endPointUrlMap={},this.ajaxRequestMap={},this.ajaxRequestMap[t.Ajax.AjaxActionTypes.Copy]=new t.Ajax.CopyRequest(this),this.ajaxRequestMap[t.Ajax.AjaxActionTypes.Move]=new t.Ajax.MoveRequest(this),this.ajaxRequestMap[t.Ajax.AjaxActionTypes.CreateFolder]=new t.Ajax.CreateFolderRequest(this),this.ajaxRequestMap[t.Ajax.AjaxActionTypes.Delete]=new t.Ajax.DeleteRequest(this),this.ajaxRequestMap[t.Ajax.AjaxActionTypes.FolderStruct]=new t.Ajax.FolderStructRequest(this),this.ajaxRequestMap[t.Ajax.AjaxActionTypes.Rename]=new t.Ajax.RenameRequest(this),this.ajaxRequestMap[t.Ajax.AjaxActionTypes.UploadFile]=new t.Ajax.UploadFileRequest(this)}}();e.Configuration=n,e.L10NPrefix="f14fm",e.Title="FManager",e.TitleShort="FM",e.Config=new n,e.AppBuffer=new t.Memory.AppBuffer;var o={};e.configure=function(n){n&&$.extend(!0,e.Config,n),e.Config.MOCK?function(){e.Config.endPointUrlMap[t.Ajax.AjaxActionTypes.UploadFile]="action/upload/file",e.Config.inMemoryData=new t.Mock.MockNavigationMap;var n=e.Config.ajaxRequestMap;n[t.Ajax.AjaxActionTypes.Copy]=new t.Mock.MockCopyRequest(e.Config),n[t.Ajax.AjaxActionTypes.Move]=new t.Mock.MockMoveRequest(e.Config),n[t.Ajax.AjaxActionTypes.CreateFolder]=new t.Mock.MockCreateFolderRequest(e.Config),n[t.Ajax.AjaxActionTypes.Delete]=new t.Mock.MockDeleteRequest(e.Config),n[t.Ajax.AjaxActionTypes.FolderStruct]=new t.Mock.MockFolderStructRequest(e.Config),n[t.Ajax.AjaxActionTypes.Rename]=new t.Mock.MockRenameRequest(e.Config),n[t.Ajax.AjaxActionTypes.UploadFile]=new t.Mock.MockUploadFileRequest(e.Config)}():function(){if(void 0===e.Config.rootFolder)throw"Root folder must be set.";if(void 0===e.Config.endPointUrlMap||0==Object.keys(e.Config.endPointUrlMap).length)throw"The map with end point urls is empty or null."}(),e.Config.allowShortcuts&&window.addEventListener("keydown",function(t){var e=void 0;e&&e.Execute(),t.preventDefault()},!1)},e.registerShortcut=function(t){o[t.shortcut]=t}}(t.Core||(t.Core={}))}(f14||(f14={}));!function(t){!function(e){(t.Localization||(t.Localization={})).Init=function(){var e=t.Core.Config.L10NProvider||t.L10n.Config.L10nProvider;e.AddLocale("ru",{"f14fm.io.accept":"Принять","f14fm.io.select-all":"Выбрать все","f14fm.io.clear-selection":"Снять выделение","f14fm.io.inverse-selection":"Обратить выделение","f14fm.io.upload":"Загрузить файлы","f14fm.io.select.files":"Выбрать файлы","f14fm.io.delete":"Удалить","f14fm.io.create-folder":"Создать папку","f14fm.io.rename":"Переименовать","f14fm.io.move":"Переместить","f14fm.io.copy":"Копировать","f14fm.io.paste":"Вставить","f14fm.apply":"Применить","f14fm.close":"Закрыть","f14fm.cancel":"Отмена","f14fm.popup.delete.title":"Удалить файлы и папки...","f14fm.popup.delete.desc":"Вы уверены что хотите удалить эти файлы\\папки?","f14fm.popup.upload.title":"Загрузка файлов","f14fm.popup.rename.error.exist":"Файл с таким именем уже существует! Имя файла: {0}","f14fm.toast.msg.selection.empty":"Ни один файл не выбран.","f14fm.toast.msg.same.folder":"Папка назначения совпадает с исходной папкой.","f14fm.toast.msg.dir.created":"Новая папка создана.","f14fm.toast.delete.count.format":"Удалено {0} объектов."}),e.AddLocale("en",{"f14fm.io.accept":"Done","f14fm.io.select-all":"Select All","f14fm.io.clear-selection":"Clear Selection","f14fm.io.inverse-selection":"Inverse Selection","f14fm.io.upload":"Upload Files","f14fm.io.select.files":"Select files","f14fm.io.delete":"Delete","f14fm.io.create-folder":"Create folder","f14fm.io.rename":"Rename","f14fm.io.move":"Move","f14fm.io.copy":"Copy","f14fm.io.paste":"Paste","f14fm.io.apply":"Apply","f14fm.close":"Close","f14fm.cancel":"Cancel","f14fm.popup.delete.title":"Delete files and folders...","f14fm.popup.delete.desc":"Are you sure you want to delete this files\\folders?","f14fm.popup.upload.title":"File uploader","f14fm.popup.rename.error.exist":"A File with this name already exists! File name: {0}","f14fm.toast.msg.selection.empty":"No selected files.","f14fm.toast.msg.same.folder":"Destination folder coincides with the source folder.","f14fm.toast.msg.dir.created":"A new directory has been created.","f14fm.toast.delete.count.format":"{0} items deleted."})}}()}(f14||(f14={}));!function(t){!function(e){e.getString=function(e){return(t.Core.Config.L10NProvider||t.L10n.Config.L10nProvider).GetString(t.Core.L10NPrefix+e)},e.NextInt=function(t,e){return Math.round(Math.random()*(e-t)+t)}}(t.Utils||(t.Utils={}))}(f14||(f14={}));!function(t){!function(e){function n(n,o,i,r,a,s,l){var u=!1;if(null!=o)if(Array.isArray(o))for(var c=0,p=o;c<p.length;c++){var f=p[c];if(t.Core.Config.endPointUrlMap[f]){u=!0;break}}else u=null!=t.Core.Config.endPointUrlMap[o];else u=!0;if(u){var d={classes:i,icon:r,shortcut:a,text:s,action:l};n.AddButton(e.ActionButton.Create(d))}}var o,i;e.Render=function(){i&&(i.$This.remove(),i=null),function(){if(void 0===(o=$("body")))throw"Current html does not contains body element.";i=new e.UIContainer,o.prepend(i.$This);var r=t.Core.Config,a=t.Ajax.AjaxActionTypes,s=t.Events.ActionButtonEvents,l=i.ContentPanel.FileActionPanel.ActionPanel;if(r.selectCallback&&l.AddButton(e.ActionButton.Create({classes:"btn-primary",icon:"mdl2-accept",text:t.Utils.getString(".io.accept"),action:t.Events.ActionButtonEvents.AcceptSelection})),n(l,a.UploadFile,"btn-primary","mdl2-upload",null,t.Utils.getString(".io.upload"),s.UploadObjects),n(l,a.CreateFolder,null,"mdl2-new-folder",null,t.Utils.getString(".io.create-folder"),s.CreateFolder),n(l,a.Delete,null,"mdl2-delete",null,t.Utils.getString(".io.delete"),s.DeleteObjects),n(l,a.Rename,null,"mdl2-rename",null,t.Utils.getString(".io.rename"),s.RenameObjects),n(l,a.Copy,null,"mdl2-copy","ctrl+c",t.Utils.getString(".io.copy"),s.CopyObjects),n(l,a.Move,null,"mdl2-move","ctrl+x",t.Utils.getString(".io.move"),s.MoveObjects),n(l,[a.Move,a.Copy],null,"mdl2-paste","ctrl+v",t.Utils.getString(".io.paste"),s.PasteObjects),n(l,null,null,"mdl2-select-all",null,t.Utils.getString(".io.select-all"),s.SelectObjects),r.actionButtons&&r.actionButtons.length>0)for(var u=0,c=t.Core.Config.actionButtons;u<c.length;u++){var p=c[u];l.AddButton(e.ActionButton.Create(p))}}()},e.RenderFileStruct=function(e,n){t.Core.Config.DEBUG&&console.log("Folders: "+e.length+" Files: "+n.length),i.ContentPanel.FileStructPanel.Fill(e,n)},e.GetUIContainer=function(){return i},e.GetFileStructItemSet=function(){return i.ContentPanel.FileStructPanel.Items},e.GetCheckedItems=function(){return i.ContentPanel.FileStructPanel.GetCheckedItems()},e.ShowPopup=function(t){i.PopupContainer.SetPopup(t)},e.HidePopup=function(){i.PopupContainer.UnsetPopup()},e.ShowToast=function(t){i.ToastContainer.Show(t)},e.HideToast=function(){i.ToastContainer.Hide()},e.DisplayPayloadError=function(t){t.hasErrors()&&e.ShowToast({message:t.errors.join("\n"),title:"Ajax response"})}}(t.UI||(t.UI={}))}(f14||(f14={}));!function(t){!function(e){var n=t.Models,o=function(){return function(){this.$This=$("<div>").addClass("ui-container"),this.$This.append((this.ToastContainer=new i).$This),this.$This.append((this.PopupContainer=new r).$This),this.$This.append((this.ContentPanel=new a).$This)}}();e.UIContainer=o;var i=function(){function t(){this.isShown=!1,this.$This=$("<div>").addClass("ui-toast-container"),this.$Title=$("<div>").addClass("ui-toast-title").appendTo(this.$This),this.$Message=$("<div>").addClass("ui-toast-message").appendTo(this.$This),this.$Title.text("Toast title"),this.$Message.text("Lorem Ipsum is simply dummy text of the printing and typesetting industry. Lorem Ipsum has been the industry's standard dummy text ever since the 1500s, when an unknown printer took a galley of type and scrambled it to make a type specimen book. It has survived not only five centuries, but also the leap into electronic typesetting, remaining essentially unchanged. It was popularised in the 1960s with the release of Letraset sheets containing Lorem Ipsum passages, and more recently with desktop publishing software like Aldus PageMaker including versions of Lorem Ipsum."),this.$This.hide()}return t.prototype.IsShown=function(){return this.isShown},t.prototype.Show=function(t){var e=this;if(!this.isShown){t.title&&t.title.length>0?(this.$Title.text(t.title),this.$Title.css("display","block")):this.$Title.css("display","none"),this.$Message.text(t.message);var n=Math.min(1e4,t.timeout)||3e3;this.$This.css({display:"",bottom:"-300px",opacity:"0"}).animate({bottom:"0px",opacity:"1"},400,function(){return function(t){t.isShown=!0,setTimeout(function(){t.Hide()},n)}(e)})}},t.prototype.Hide=function(){var t=this;this.$This.animate({bottom:"-300px",opacity:"0"},150,function(){t.isShown=!1,t.$This.css("display","none")})},t}();e.ToasContainer=i;var r=function(){function t(){this.$This=$("<div>").addClass("ui-popup-container"),this.$This.css("opacity","0"),this.$This.css("display","none")}return t.prototype.SetPopup=function(t){if(this.Popup){this.UnsetPopup();var e=this;setTimeout(function(){e.SetPopup(t)},500)}else this.Popup=t,this.$This.append(t.$This),this.$This.css("display","flex"),this.$This.fadeTo(150,1)},t.prototype.UnsetPopup=function(){if(this.Popup){var t=this;this.$This.fadeTo(150,0,function(){t.$This.css("display","none"),t.$This.empty(),t.Popup=void 0})}},t}();e.PopupContainer=r;var a=function(){return function(){this.$This=$("<div>").addClass("ui-content-panel"),this.$This.append((this.FileActionPanel=new s).$This),this.$This.append((this.FileStructPanel=new l).$This)}}();e.ContentPanel=a;var s=function(){return function(){this.$This=$("<div>").addClass("ui-file-action-panel"),this.$This.append((this.LogoButton=new e.LogoButton).$This),this.$This.append((this.ActionPanel=new u).$This)}}();e.FileActionPanel=s;var l=function(){function e(){this.Items=[],this.$This=$("<div>").addClass("ui-file-struct-panel")}return e.prototype.Fill=function(e,o){this.Items.length=0,this.$This.empty(),t.Explorer.NavigationData.IsRootPath()||this.AddItem(n.FileSystemItemType.Back);for(var i=0,r=e;i<r.length;i++){var a=r[i];this.AddItem(n.FileSystemItemType.Folder,a)}for(var s=0,l=o;s<l.length;s++){a=l[s];this.AddItem(n.FileSystemItemType.File,a)}},e.prototype.AddItem=function(t,e){t===n.FileSystemItemType.Back&&(e={name:"up"});var o=new c(t,e);this.Items.push(o),this.$This.append(o.$This)},e.prototype.GetCheckedItems=function(){return this.Items.filter(function(t){return t.CheckState})},e}();e.FileStructPanel=l;var u=function(){function t(){this.Buttons=[],this.$This=$("<div>").addClass("ui-action-buttons-panel")}return t.prototype.AddButton=function(t){this.Buttons.push(t),this.$This.append(t.$This)},t}();e.ActionPanel=u;var c=function(){function e(e,o){var i=this;switch(this.CheckState=!1,this.Type=e,this.FileSystemInfo=o,this.$This=$("<div>").addClass("ui-file-struct-item ui-input-group").on("click",function(t){return i.TriggerCheckState()}).on("dblclick",function(e){switch(i.Type){case t.Models.FileSystemItemType.Back:t.Explorer.GoBack();break;case t.Models.FileSystemItemType.File:t.Explorer.OpenFile(i.FileSystemInfo.name);break;case t.Models.FileSystemItemType.Folder:t.Explorer.GoForward(i.FileSystemInfo.name)}}),this.IconContainer=$("<div>").addClass("ui-item-icon"),this.NameContainer,this.Icon=$("<i>"),this.IconContainer.append(this.Icon),e){case n.FileSystemItemType.File:this.Icon.addClass("mdl2-file");break;case n.FileSystemItemType.Folder:this.Icon.addClass("mdl2-folder");break;case n.FileSystemItemType.Back:this.Icon.addClass("mdl2-more")}e!==n.FileSystemItemType.Back&&(this.CheckBox=$("<div>").addClass("ui-item-check"),this.NameContainer=$("<div>").addClass("ui-item-name").text(o.name)),this.CheckBox&&(this.CheckBox.on("click",function(t){return i.CheckBoxStateChangeHandler(t,i)}),this.createInputGroupItem("min").append(this.CheckBox).appendTo(this.$This)),this.createInputGroupItem("min").append(this.IconContainer).appendTo(this.$This),this.NameContainer&&this.createInputGroupItem("max").append(this.NameContainer).appendTo(this.$This)}return e.prototype.createInputGroupItem=function(t){return $("<div>").addClass("ui-input-group-item "+t)},e.prototype.SetItemName=function(t){this.FileSystemInfo.name=t,this.NameContainer.text(t)},e.prototype.SetCheckState=function(t){this.CheckState=t,this.CheckState?this.$This.addClass("checked"):this.$This.removeClass("checked")},e.prototype.TriggerCheckState=function(){this.CheckBox&&this.Type===t.Models.FileSystemItemType.File&&this.CheckBox.trigger("click")},e.prototype.CheckBoxStateChangeHandler=function(t,e){e.SetCheckState(!e.CheckState),t&&t.stopPropagation()},e.prototype.ToString=function(){return"[Type: "+this.Type+", Name: "+this.FileSystemInfo.name+", CheckState: "+this.CheckState},e}();e.FileStructItem=c}(t.UI||(t.UI={}))}(f14||(f14={}));!function(t){!function(e){var n=function(){function t(t,e,n){this.$This=$("<div>").addClass("ui-btn"),n&&n.length>0&&this.$This.addClass(n),this.SetIcon(e),this.SetText(t)}return t.prototype.SetText=function(t){return this.$Text||(this.$Text=$("<span>").addClass("ui-btn-text").appendTo(this.$This)),t||(t=""),this.$Text.text(t),this.$This.attr("title",t),this},t.prototype.SetIcon=function(t){return void 0!==t&&t.length>0?this.$Icon?(this.$Icon.removeClass(),this.$Icon.addClass(t)):this.$Icon=$("<i>").addClass("ui-btn-icon").addClass(t).prependTo(this.$This):this.$Icon&&(this.$Icon.remove(),this.$Icon=void 0),this},t.prototype.OnClick=function(t){return t?this.$This.on("click",t):this.$This.off("click"),this},t}();e.BaseButton=n;var o=function(t){function e(){var e=t.call(this)||this;return e.$This.addClass("ui-action-btn"),e}return __extends(e,t),e.prototype.SetText=function(e){return t.prototype.SetText.call(this,e)},e.prototype.SetIcon=function(e){return t.prototype.SetIcon.call(this,e)},e.prototype.Execute=function(){this.$This.trigger("click")},e.Create=function(t){var n=new e;return t.classes&&n.$This.addClass(t.classes),n.SetText(t.text),n.SetIcon(t.icon),n.OnClick(t.action),n.shortcut=t.shortcut,n},e}(n);e.ActionButton=o;var i=function(){return function(){var n=this;this.$This=$("<div>").addClass("ui-logo-button"),this.$Text=$("<span>").text(t.Core.Title).appendTo(this.$This),this.$This.on("click",function(o){var i=e.GetUIContainer().ContentPanel.FileActionPanel;i.$This.hasClass("collapsed")?(i.$This.removeClass("collapsed"),n.$Text.text(t.Core.Title)):(i.$This.addClass("collapsed"),n.$Text.text(""))})}}();e.LogoButton=i}(t.UI||(t.UI={}))}(f14||(f14={}));!function(t){!function(t){var e=function(){return function(){this.$This=$("<input>").addClass("ui-textbox")}}();t.TextBox=e}(t.UI||(t.UI={}))}(f14||(f14={}));!function(t){!function(e){!function(n){var o=function(){function n(){this.FooterButtons=[],this.$This=$("<div>").addClass("ui-popup"),this.Container=$("<div>").addClass("container").appendTo(this.$This),this.Header=$("<div>").addClass("ui-popup-header"),this.Body=$("<div>").addClass("ui-popup-body"),this.Footer=$("<div>").addClass("ui-popup-footer"),this.AddErrorSection(),this.Container.append(this.Header).append(this.Body).append(this.Footer)}return n.prototype.SetTitle=function(t){this.Title||(this.Title=$("<span>").addClass("ui-popup-title"),this.Header.append(this.Title)),this.Title.text(t)},n.prototype.AddFooterButton=function(t){this.FooterButtons.push(t),this.Footer.append(t.$This)},n.prototype.AddErrorSection=function(){this.ErrorSection=$("<div>").addClass("ui-popup-errors").appendTo(this.Body).hide()},n.prototype.PopulatePayloadErrors=function(t){var e=this;this.ErrorSection.empty();var n=function(t){$("<div>").addClass("ui-popup-error-message").text(t).appendTo(e.ErrorSection)};if(t.hasErrors())for(var o=0,i=t.errors;o<i.length;o++){n(i[o])}this.ErrorSection.show(200)},n.prototype.GenerateButton=function(t,n){var o=new e.BaseButton;return o.SetText(t),n&&o.$This.on("click",n),o},n.prototype.CreateCloseBtn=function(){return this.GenerateButton(t.Utils.getString(".close"),function(t){e.HidePopup()})},n}();n.Popup=o;var i=function(n){function o(o){var i=n.call(this)||this;i.SetTitle(t.Utils.getString(".io.rename")),i.item=o,i.CreateRenameTextbox(i.item);var r=i.GenerateButton(t.Utils.getString(".apply"),function(n){var o=i.Body.find(".tb-rename"),r=new t.Ajax.RenameParam(t.Explorer.NavigationData.GetCurrentPath()),a=o.attr("data-origin-name"),s=o.val();a!==s&&r.AddRenameItem(a,s,o.data("io-type")==t.Models.FileSystemItemType.File),r.HasData()?t.Core.Config.ajaxRequestMap[t.Ajax.AjaxActionTypes.Rename].execute(r,function(t){return i.updateItemNames(t)}):e.HidePopup()});return i.AddFooterButton(r),i.AddFooterButton(i.CreateCloseBtn()),i}return __extends(o,n),o.prototype.CreateRenameTextbox=function(t){var n=t.FileSystemInfo.name,o=new e.TextBox;o.$This.addClass("tb-rename"),o.$This.attr("data-origin-name",n),o.$This.data("io-type",t.Type),o.$This.val(n),this.Body.append(o.$This)},o.prototype.updateItemNames=function(t){if(t.hasErrors())this.PopulatePayloadErrors(t);else{var n=t;this.item.SetItemName(n.renamedObjects[0].name),e.HidePopup()}},o}(o);n.RenamePopup=i;var r=function(n){function o(o,i){var r=n.call(this)||this;r.$This.addClass("danger"),r.SetTitle(t.Utils.getString(".popup.delete.title")),r.FolderPath=o,r.ItemNames=i,$("<p>").text(t.Utils.getString(".popup.delete.desc")).appendTo(r.Body);var a=r.GenerateButton(t.Utils.getString(".io.delete"),function(n){var o=new t.Ajax.DeleteParam(r.FolderPath,r.ItemNames.map(function(t,e,n){return t.name}));t.Core.Config.ajaxRequestMap[t.Ajax.AjaxActionTypes.Delete].execute(o,function(n){t.Core.Config.DEBUG&&console.log(o),n.hasErrors()&&r.PopulatePayloadErrors(n);var i=n;i.affected>0&&(t.Explorer.ReNavigate(),e.ShowToast({message:t.Utils.getString(".toast.delete.count.format").Format(i.affected.toString())}),i.hasErrors()||e.HidePopup())})});return r.AddFooterButton(a),r.AddFooterButton(r.CreateCloseBtn()),r}return __extends(o,n),o}(o);n.DeletePopup=r;var a=function(n){function o(){var e=n.call(this)||this;return e.tasksCount=0,e.SetTitle(t.Utils.getString(".popup.upload.title")),e.$Form=$("<form>").addClass("ui-upload-form").appendTo(e.Body),e.$Form.text("No files selected."),e.AddFooterButton(e.CreateFileSelectBtn()),e.AddFooterButton(e.CreateUploadButton()),e.AddFooterButton(e.CreateCloseBtn()),e}return __extends(o,n),o.prototype.AddFilePresenter=function(t){var n=$("<div>").addClass("ui-input-group file-container").data("file",t);$("<div>").addClass("ui-input-group-item max").text(t.name).appendTo(n),$("<div>").addClass("ui-input-group-item min actions").append(new e.BaseButton("","mdl2-close","icon-transparent close-btn").OnClick(function(t){$(t.target).closest(".file-container").remove()}).$This).appendTo(n),$("<div>").addClass("ui-input-group-item min status").append($("<i>").addClass("mdl2 status-value")).appendTo(n),$("<div>").addClass("ui-input-group-item min progress").append($("<div>").addClass("progress-value").text("0%")).appendTo(n);this.$Form.append(n)},o.prototype.CreateFileSelectBtn=function(){var n=this,o=new e.BaseButton;o.$This.addClass("btn-file"),o.SetText(t.Utils.getString(".io.select.files"));var i=$("<input>").attr("type","file").attr("multiple","multiple").attr("accept",t.Core.Config.uploadFileFilter||"*");return i.on("change",function(t){var e=t.target.files;if(e.length>0){n.$Form.empty();for(var o in e){e[o]instanceof File&&n.AddFilePresenter(e[o])}}}),o.$This.append(i),o},o.prototype.CreateUploadButton=function(){var e=this,n=this.GenerateButton(t.Utils.getString(".io.upload"),function(o){var i=e.$Form.find(".file-container:not(.loading,.success,.error)");i.length>0&&($(e.Footer.find(".btn-file")).addClass("disabled"),n.$This.addClass("disabled"),i.each(function(o,i){e.tasksCount+=1;var r=$(i),a=$(r.find(".progress-value")[0]),s=r.data("file");r.addClass("loading");var l=new t.Ajax.UploadFileParam(t.Explorer.NavigationData.GetCurrentPath(),s,function(t){if(t.lengthComputable){var e=Math.ceil(t.loaded/t.total*100);a.text(e+"%")}});t.Core.Config.ajaxRequestMap[t.Ajax.AjaxActionTypes.UploadFile].execute(l,function(o){r.removeClass("loading"),o.hasErrors()?r.addClass("error"):r.addClass("success"),e.tasksCount=Math.max(0,e.tasksCount-1),0===e.tasksCount&&($(e.Footer.find(".btn-file")).removeClass("disabled"),n.$This.removeClass("disabled"),t.Explorer.ReNavigate())})}))});return n.$This.addClass("btn-primary btn-upload"),n},o}(o);n.UploadFilesPopup=a}(e.Popups||(e.Popups={}))}(t.UI||(t.UI={}))}(f14||(f14={}));!function(t){!function(t){!function(t){var e=function(){return function(){}}();t.ToastData=e}(t.Toasts||(t.Toasts={}))}(t.UI||(t.UI={}))}(f14||(f14={}));!function(t){!function(e){function n(){var n=e.NavigationData.GetCurrentPath(),o=t.Core.Config;o.DEBUG&&console.log("Navigate => "+n),o.ajaxRequestMap[t.Ajax.AjaxActionTypes.FolderStruct].execute(new t.Ajax.FolderStructParam(n),function(e){if(e.hasErrors())t.UI.DisplayPayloadError(e);else{var n=e;t.UI.RenderFileStruct(n.folders,n.files)}})}e.NavigationData=new t.Navigation.NavigationStack,e.NavigateTo=function(t){if(void 0===t)throw"Folder path must be set.";e.NavigationData.Clear(),e.NavigationData.Add(t),n()},e.GoForward=function(t){t&&(e.NavigationData.Add(t),n())},e.GoBack=function(){e.NavigationData.Pop(),n()},e.ReNavigate=function(){n()},e.OpenFile=function(t){}}(t.Explorer||(t.Explorer={}))}(f14||(f14={}));var f14,FManager=function(){return function(t){f14.Localization.Init(),f14.Core.configure(t),f14.UI.Render(),f14.Explorer.NavigateTo(f14.Core.Config.rootFolder)}}();!function(t){!function(e){var n=function(e){function n(){var n=e.call(this)||this,o=new t.Models.DirectoryInfo("C:");o.CreateFile("boot.sys"),o.CreateFile("autorun.exe"),o.CreateFile("pagefile.sys");for(var i=o.CreateFolder("MyDocs"),r=(o.CreateFolder("Users"),i.CreateFolder("Images")),a=0;a<30;a++){var s="image-"+(a+1)+".jpg";r.CreateFile(s)}var l=i.CreateFolder("Sounds");for(a=0;a<10;a++){var u="sound-"+(a+1)+".mp3";l.CreateFile(u)}return n.MapFolder(o),console.log(n.ToString()),n}return __extends(n,e),n}(t.Memory.InMemoryNavigationMap);e.MockNavigationMap=n;var o=function(){return function(t){this.config=t,this.map=t.inMemoryData}}();e.MockOperationRequest=o;var i=function(e){function n(t){return e.call(this,t)||this}return __extends(n,e),n.prototype.getUrl=function(){return this.config.endPointUrlMap[t.Ajax.AjaxActionTypes.Copy]},n.prototype.execute=function(e,n){for(var o=this.map.GetFolderItemForPath(e.sourceDirectory),i=this.map.GetFolderItemForPath(e.destinationDirectory),r=function(e,n){var o=new t.Models.FileInfo(e.name,n);return $.extend(!0,o,e),o},a=function(e,n){for(var o=new t.Models.DirectoryInfo(e.name,n),i=0,s=e.Files;i<s.length;i++){var l=s[i];o.AddObject(r(l,o))}for(var u=0,c=e.Folders;u<c.length;u++){l=c[u];o.AddObject(a(l,o))}return o},s=0,l=e.targets;s<l.length;s++){var u=l[s],c=o.GetObject(u.name);if(c)if(u.isFile){var p=r(c,i);i.AddObject(p),this.config.DEBUG&&console.log(p)}else{var f=a(c,i);this.map.MapFolder(f),i.AddObject(f),this.config.DEBUG&&(console.log(f),console.log(this.map.ToString()))}}n(new t.Ajax.CopyResult)},n}(o);e.MockCopyRequest=i;var r=function(e){function n(t){return e.call(this,t)||this}return __extends(n,e),n.prototype.getUrl=function(){return this.config.endPointUrlMap[t.Ajax.AjaxActionTypes.Move]},n.prototype.execute=function(e,n){for(var o=this.map.GetFolderItemForPath(e.sourceDirectory),i=this.map.GetFolderItemForPath(e.destinationDirectory),r=[],a=0,s=e.targets;a<s.length;a++){var l=s[a],u=o.DeleteObject(l.name);u&&r.push(u)}i.AddObject(r);n(new t.Ajax.MoveResult)},n}(o);e.MockMoveRequest=r;var a=function(e){function n(t){return e.call(this,t)||this}return __extends(n,e),n.prototype.getUrl=function(){return this.config.endPointUrlMap[t.Ajax.AjaxActionTypes.CreateFolder]},n.prototype.execute=function(e,n){var o=this.map.GetFolderItemForPath(e.currentFolderPath).CreateFolder(e.name);this.map.MapFolder(o);n(new t.Ajax.CreateFolderResult)},n}(o);e.MockCreateFolderRequest=a;var s=function(e){function n(t){return e.call(this,t)||this}return __extends(n,e),n.prototype.getUrl=function(){return this.config.endPointUrlMap[t.Ajax.AjaxActionTypes.Delete]},n.prototype.execute=function(e,n){for(var o=this.map.GetFolderItemForPath(e.currentFolderPath),i=0,r=e.targets;i<r.length;i++){var a=r[i];o.DeleteObject(a)}var s=new t.Ajax.DeleteResult;s.affected=e.targets.length,n(s)},n}(o);e.MockDeleteRequest=s;var l=function(e){function n(t){return e.call(this,t)||this}return __extends(n,e),n.prototype.getUrl=function(){return this.config.endPointUrlMap[t.Ajax.AjaxActionTypes.FolderStruct]},n.prototype.execute=function(e,n){var o=this.map.GetFolderItemForPath(e.currentFolderPath);if(void 0===o)throw"No folder info for given path: "+e.currentFolderPath;var i=new t.Ajax.FolderStructResult;i.files=o.Files,i.folders=o.Folders,n(i)},n}(o);e.MockFolderStructRequest=l;var u=function(e){function n(t){return e.call(this,t)||this}return __extends(n,e),n.prototype.getUrl=function(){return this.config.endPointUrlMap[t.Ajax.AjaxActionTypes.Rename]},n.prototype.execute=function(e,n){var o=this.map.GetFolderItemForPath(e.currentFolderPath);if(void 0===o)throw"No folder info for given path: "+e.currentFolderPath;for(var i=new t.Ajax.RenameResult,r=0,a=e.targets;r<a.length;r++){var s=a[r];if(s.isFile)o.FileExists(s.name)?i.errors.push(t.Utils.getString(".popup.rename.error.exist").Format(s.name)):(o.GetFile(s.oldName).name=s.name,i.renamedObjects.push(s));else if(o.FolderExists(s.name))i.errors.push(t.Utils.getString(".popup.rename.error.exist").Format(s.name));else{var l=o.GetFolder(s.oldName),u=l.GetFullPath();l.name=s.name,t.Core.Config.DEBUG&&console.log("Old path: "+u+" New path: "+l.GetFullPath()),this.map.replace(u,l),i.renamedObjects.push(s)}}n(i)},n}(o);e.MockRenameRequest=u;var c=function(e){function n(){return null!==e&&e.apply(this,arguments)||this}return __extends(n,e),n.prototype.getUrl=function(){return this.config.endPointUrlMap[t.Ajax.AjaxActionTypes.UploadFile]},n.prototype.execute=function(e,n){var o=this,i=t.Utils.NextInt(50,150),r=0,a=setInterval(function(){r+=1,e.progressChanged&&e.progressChanged(new ProgressEvent("counter",{lengthComputable:!0,total:100,loaded:r}))},i);setTimeout(function(){clearInterval(a);o.map.GetFolderItemForPath(e.currentFolderPath).CreateFile(e.file.name);var i=new t.Ajax.UploadFileResult;n(i)},100*i)},n}(o);e.MockUploadFileRequest=c}(t.Mock||(t.Mock={}))}(f14||(f14={}));